<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<body>
		<section>
		<h2>启动、配置Apache</h2>
		<ul>
			<li>查看Apache版本：httpd -v</li>
			<li>启动Apache: sudo apachectl start<br>
				<code>启动后，在浏览器中输入 http://127.0.0.1 或 http://localhost 如果看到 It Works! 页面：那么 Apache 就启动成功了，站点的根目录为系统级根目录 /Library/WebServer/Documents。</code>
			</li>
			<li>停止Apache: sudo apachectl stop</li>
			<li>重启Apache: sudo apachectl restart</li>
		</ul>
		<span>Apache配置文件：/etc/apache2/httpd.conf</span>
		
		<h3>创建用户级根目录，以更方便管理和操作</h3>
		<ul>
			<li>在用户目录下创建Sites目录：cd；mkdir Sites;touch Sites/.localized,旧版本的Mac系统中，如果该目录已存在，则略过</li>
			<li>cd /etc/apache2/users检查该目录下是否存在username.conf文件，username为当前用户名，如果没有则创建一个:sudo touch username.conf，并修改文件权限:sudo chmod 644 username.conf</li>
			<li>编辑username.conf：sudo vim username.conf,将一下配置信息写入文件：<br>
				<code>
				&lt; Directory "/Users/username/Sites/"&gt;<br>
					 Options Indexes MultiViews FollowSymLinks<br>
					 AllowOverride All<br>
					 Order allow,deny<br>
					 Allow from all<br>
					 Require all granted<br>
				 &lt; /Directory&gt;
				</code>
			</li>
			<li>编辑配置文件：/etc/apache2/httpd.conf,解注以下两行代码：<br>
				<code>
					Include /private/etc/apache2/extra/httpd-userdir.conf<br>
					//包含或引用用户目录配置文件
					LoadModule userdir_module libexec/apache2/mod_userdir.so<br>
					//加载用户目录共享库文件
				</code>
			</li>
			<li>编辑用户目录配置文件：/etc/apache2/extra/httpd-userdir.conf，解注以下一行代码：<br>
				<code>Include /private/etc/apache2/users/*.conf<br>
					//包含或引用该目录下所有的配置文件
				</code>
			</li>
			<li>重启Apache服务器<br>
				<code>
					在浏览器中输入 http://127.0.0.1/~username 或 http://localhost/~username，即可测试用户目录是否工作。
				</code>
			</li>
		</ul>
		</section><br>
		<section>
			<h2>启动并配置Php：Mac OS X默认集成了PHP环境</h2>
			<ul>
				<li>编辑Apache配置文件(/etc/apache2/httpd.conf)(因为要让Apache支持Php)，解注以下一行代码：<br>
					<code>
						LoadModule php5_module libexec/apache2/libphp5.so<br>
						//加载php共享动态库
					</code>
				</li>
				<li>重启Apache，现在PHP应该已经工作了</li>
				<li>查看PHP配置文件(/private/etc/php.ini.default)：php --ini<br>
					<code>
						我们可以将 /private/etc/php.ini.default 复制一份命名为 /private/etc/php.ini 并修改配置文件，如，设置 display_errors = On 打开PHP错误显示。
					</code>
				</li>
			</ul>
		</section>
		<section>
					<h2>配置Apache开启Https服务（iOS 7.1 以上的设备部署无线安装环境就必须使用 HTTPS）</h2>
					<ul>
						<li>创建SSL目录存放证书cd /etc/apache2/;sudo mkdir ssl;cd ssl</li>
						<li>创建主机密钥：<br>sudo ssh-keygen -f local.server.com.key或者sudo openssl genrsa -out local.server.com.key 2048</li>
						<li>创建证书签发请求文件（CSR）：<br>
							<code>sudo openssl req -new -key local.server.com.key -out local.server.com.csr<br>
								<p>会提示输入各项信息,由于这是自签名的证书，除了 Common Name (e.g. server FQDN or YOUR name) []: FQDN（ fully qualified domain name）必须是服务器域名或 IP 外，其他都不重要，可以随意填写或一路回车，这里作为测试使用 local.server.com。</p>
							</code>
						</li>
						<li>创建SSL文件:<br>
							在生产环境中，我们需要提交证书申请（CSR）文件给证书颁发机构，由证书颁发机构提供SSL证书。<br>
							<code>
								sudo openssl x509 -req -days 365 -in local.server.com.csr -signkey local.server.com.key -out local.server.com.crt<br>或者：<br>
								sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout local.server.com.key -out local.server.com.crt
							</code>
						</li>
						<li>配置NOPASS密钥（为了配置Apache需要创建一个NOPASS密钥）：<br>
							<code>sudo openssl rsa -in local.server.com.key -out local.server.com.nopass.key</code><br>
						</li>
						<span>现在查看SSL目录下应该有以下文件：ls -l</span>
						<ul>
							<li>-rw-r--r--  1 root  wheel  1180 10 22 13:08 local.server.com.crt</li>
							<li>-rw-r--r--  1 root  wheel   993 10 22 11:58 local.server.com.csr</li>
							<li>-rw-------  1 root  wheel  1679 10 22 11:44 local.server.com.key</li>
							<li>
								-rw-r--r--  1 root  wheel   408 10 22 11:44 local.server.com.key.pub
							</li>
							<li>-rw-r--r--  1 root  wheel  1679 10 22 13:19 local.server.com.nopass.key</li>
						</ul>
					</ul>
		</section>
		<section><h2>接下来要配置SSL</h2>
		<ol>
			<li>
				编辑Apache配置文件(/etc/apache2/httpd.conf)解注以下代码：<br>
				<code>LoadModule ssl_module libexec/apache2/mod_ssl.so<br>
					//加载SSL共享库
				</code>
			</li>
			<li>编辑Apache配置文件(/etc/apache2/httpd.conf)解注以下代码：<br>
				<code>Include /private/etc/apache2/extra/httpd-ssl.conf<br>
					//包含或饮用SSL配置文件
				</code>
			</li>
			<li>编辑SSL配置文件(/etc/apache2/extra/httpd-ssl.conf):<br>
				<p>httpd-ssl.conf 中已经有一条 &lt; VirtualHost &gt; 记录，我们将其注释掉，新建一条：<br>
					<code>
						&lt; VirtualHost *:443 &gt;<br>
						 #General setup for the virtual host<br>
						 DocumentRoot "/Library/WebServer/Documents"<br>
						 ServerName local.server.com<br>

						 #SSL Engine Switch:<br>
						 SSLEngine on<br>

						 #Server Certificate:<br>
						 SSLCertificateFile "/etc/apache2/ssl/local.server.com.crt"<br>

						 #Server Private Key:<br>
						 SSLCertificateKeyFile "/etc/apache2/ssl/local.server.com.key"<br>

						 #SSL Engine Options:<br>
						 &lt; FilesMatch "\.(cgi|shtml|phtml|php)$" &gt;<br>
							 SSLOptions +StdEnvVars<br>
						 &lt; /FilesMatch &gt;<br>
						 &lt; Directory "/Library/WebServer/CGI-Executables" &gt;<br>
							 SSLOptions +StdEnvVars<br>
						 &lt;/Directory &gt;<br>
						 &lt; /VirtualHost &gt;<br>
					</code>
				</p>
			</li>
			<li>
				为了能够使用 URL 访问服务器，我们需要配置HOST：sudo vi /etc/hosts,添加以下一行代码：<br>
				<code>127.0.0.1       local.server.com</code> 
			</li>
			<li>检查配置文件并重启Apache：sudo apachectl -k restart，提示：<br>
				<code>AH00526: Syntax error on line 92 of /private/etc/apache2/extra/httpd-ssl.conf:
				 SSLSessionCache: 'shmcb' session cache not supported (known names: ). Maybe you need to load the appropriate socache module (mod_socache_shmcb?).</code>
				<br>
				<p>根据提示编辑Apache配置文件(/ect/apache/httpd.conf),解注以下一行代码：<br>
					<code>LoadModule socache_shmcb_module libexec/apache2/mod_socache_shmcb.so</code>
					<br>
					<span>修正后继续重启，成功！</span><br>
					<code>此时，就可以使用 HTTPS 访问本地服务了，在浏览器中输入 https://local.server.com/ 检查。</code>
				</p>
			</li>
			<li>配置完成重启Apache时，如果遇到以下错误提示：<br>
				<ul>
					<li>进入apache的安装目录(视个人安装情况而定)：cd /usr/local/apache/conf<br>
						编辑httpd.conf,搜索"#ServerName"，添加ServerName localhost:80<br>
						
					</li>
					<li>重启Apache</li>
				</ul>
			</li>
		</ol>
		
		</section>
	</body>
</html>